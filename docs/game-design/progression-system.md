# 성장 & 레벨업 시스템

> [← 기획 총괄로 돌아가기](./overview.md)

---

## 개요

Bone-To-Peak의 성장은 두 축으로 구성된다.

1. **인게임 성장**: 한 런 안에서의 레벨업과 스킬 선택
2. **메타 진행**: 런 간 누적되는 영구 강화와 언락

---

## 인게임 성장

### 경험치 & 레벨업

- 적 처치 시 경험치 구슬 드롭
- 네크로맨서가 구슬에 접근하면 자동 수집 (수집 범위: 2 유닛)
- 경험치가 차면 레벨업, **게임이 일시정지**되고 3개 선택지 제시 (`Time.timeScale = 0`)
- 레벨업 UI 표시 중 모든 입력 차단 (이동, 공격, 소환 불가)
- 선택지 클릭 또는 1/2/3 키로 선택, 선택 즉시 `Time.timeScale = 1` 복귀

### 레벨 상한 & 필요 경험치

- **레벨 상한**: 20 (선택지 풀이 소진되면 레벨업 없이 경험치 누적 중단)
- 실전에서는 웨이브 20까지 레벨 15~18이 일반적

| 레벨    | 필요 경험치         | 누적     |
| ------- | ------------------- | -------- |
| 1 → 2   | 10                  | 10       |
| 2 → 3   | 15                  | 25       |
| 3 → 4   | 22                  | 47       |
| 4 → 5   | 30                  | 77       |
| 5 → 6   | 40                  | 117      |
| 이후    | 이전 × 1.3 (반올림) | —        |
| 19 → 20 | 약 480              | 약 2,560 |

### 레벨업 선택지

레벨업 시 3개의 선택지가 랜덤으로 제시된다. 각 선택지는 아래 카테고리에서 추출된다.

#### 카테고리 A: 네크로맨서 강화

| 선택지         | 효과                         | 출현 가중치 |
| -------------- | ---------------------------- | ----------- |
| 체력 강화      | HP 최대치 +20                | 10          |
| 속도 강화      | 이동속도 +0.5                | 8           |
| Corpse 확장    | Corpse 수용량 +5             | 7           |
| 수집 범위 확대 | Corpse/경험치 수집 범위 +0.5 | 8           |
| 방어 강화      | 방어력 +3                    | 6           |

#### 카테고리 B: 소환 강화

| 선택지         | 효과                                    | 출현 가중치      |
| -------------- | --------------------------------------- | ---------------- |
| 소환 슬롯 확장 | 소환 슬롯 +1                            | 5 (최대 10슬롯)  |
| 소환 가속      | 소환 쿨타임 -0.3초                      | 7                |
| 새 미니언 해금 | 다음 티어 미니언 소환 가능              | 3 (해금 가능 시) |
| 소환 할인      | 모든 소환 Corpse 비용 -1 (최소 1)       | 4                |
| 자동 소환      | 가장 최근 미니언을 쿨타임마다 자동 소환 | 2 (1회 한정)     |

#### 카테고리 C: 군단 버프

| 선택지        | 효과                               | 출현 가중치  |
| ------------- | ---------------------------------- | ------------ |
| 공격력 증가   | 전체 미니언 공격력 +10%            | 10           |
| 공격속도 증가 | 전체 미니언 공격속도 +10%          | 8            |
| 생존력 증가   | 전체 미니언 HP +15%                | 8            |
| 이동속도 증가 | 전체 미니언 이동속도 +10%          | 6            |
| 뱀파이릭      | 미니언 공격 시 데미지의 5% HP 회복 | 3 (1회 한정) |

### 선택지 생성 규칙

- 3개의 선택지는 **서로 다른 카테고리**에서 1개씩 추출
- 가중치가 높을수록 출현 확률이 높음
- 이미 최대치에 도달한 선택지는 풀에서 제외
- "1회 한정" 선택지는 선택 후 풀에서 영구 제거

### 선택지 풀 크기 & 확률 계산

| 카테고리           | 선택지 수 | 가중치 합계 | 설명                                  |
| ------------------ | --------- | ----------- | ------------------------------------- |
| A: 네크로맨서 강화 | 5종       | 39          | 모든 선택지 반복 선택 가능 (상한까지) |
| B: 소환 강화       | 5종       | 21          | 자동 소환, 새 미니언 해금은 1회 한정  |
| C: 군단 버프       | 5종       | 35          | 뱀파이릭 1회 한정                     |

**확률 계산 예시 (카테고리 A)**:

```
체력 강화: 10/39 = 25.6%
속도 강화:  8/39 = 20.5%
Corpse 확장: 7/39 = 17.9%
수집 범위:   8/39 = 20.5%
방어 강화:   6/39 = 15.4%
```

### 선택지 최대 선택 횟수

각 선택지에는 최대 선택 가능 횟수가 있다.

| 선택지                | 최대 횟수        | 도달 시 효과             |
| --------------------- | ---------------- | ------------------------ |
| 체력 강화 (+20 HP)    | 10회             | HP +200 (상한 300 도달)  |
| 속도 강화 (+0.5)      | 6회              | 이동속도 8.0 (상한 도달) |
| Corpse 확장 (+5)      | 4회              | 수용량 30 (상한 도달)    |
| 수집 범위 확대 (+0.5) | 5회              | 수집 범위 4.0 유닛       |
| 방어 강화 (+3)        | 6회              | 방어력 18 (상한 근접)    |
| 소환 슬롯 확장 (+1)   | 12회             | 슬롯 15 (상한 도달)      |
| 소환 가속 (-0.3초)    | 5회              | 쿨타임 0.5초 (상한 도달) |
| 새 미니언 해금        | 해금 가능 수만큼 | 풀에서 자동 제거         |
| 소환 할인 (-1)        | 2회              | 최소 비용 1 보장         |
| 자동 소환             | 1회              | 풀에서 영구 제거         |
| 공격력 증가 (+10%)    | 무제한           | 스택 누적                |
| 공격속도 증가 (+10%)  | 무제한           | 스택 누적                |
| 생존력 증가 (+15% HP) | 무제한           | 스택 누적                |
| 이동속도 증가 (+10%)  | 무제한           | 스택 누적                |
| 뱀파이릭 (5%)         | 1회              | 풀에서 영구 제거         |

> **설계 의도**: 레벨 20까지 총 19회 선택 기회. A/B 카테고리의 상한이 있는 선택지는 합계 약 51회 분량이므로 한 런 안에서 소진되지 않는다. C 카테고리는 무제한 스택으로 후반 선택지가 부족하지 않게 보장한다.

---

## 스킬 트리 구조

스킬 트리는 3개의 경로로 분기한다. 레벨업 선택을 통해 특정 경로에 집중할 수 있다.

### 경로 1: 군주의 길 (Legion Path)

미니언 수량 극대화에 집중한다.

```
소환 슬롯 +1
    │
    ├── 소환 쿨타임 -30%
    │       │
    │       └── 자동 소환
    │
    └── 미니언 소환 비용 -1
            │
            └── 소환 시 쌍둥이 (50% 확률로 2마리 소환)
```

### 경로 2: 지배자의 길 (Domination Path)

미니언 개별 전투력 극대화에 집중한다.

```
미니언 공격력 +15%
    │
    ├── 미니언 공격속도 +20%
    │       │
    │       └── 크리티컬 (미니언 공격 시 20% 확률 2배 피해)
    │
    └── 미니언 HP +25%
            │
            └── 뱀파이릭 (공격 피해의 5% HP 회복)
```

### 경로 3: 사령관의 길 (Commander Path)

네크로맨서 자체 능력과 유틸리티를 강화한다.

```
Corpse 수용량 +10
    │
    ├── Explode 데미지 +50%
    │       │
    │       └── Explode 쿨타임 -50%
    │
    └── 수집 범위 ×2
            │
            └── 자동 수집 (화면 내 Corpse 자동 흡수)
```

> 각 경로는 배타적이지 않다. 여러 경로를 혼합 선택할 수 있으나, 한 경로에 집중할수록 최종 스킬의 시너지가 강해진다.

### 스킬 경로 선행 조건

경로의 상위 노드를 선택해야 하위 노드가 레벨업 선택지 풀에 등장한다.

| 경로   | 노드                 | 선행 조건                  |
| ------ | -------------------- | -------------------------- |
| 군주   | 소환 쿨타임 -30%     | 소환 슬롯 +1 선택 2회 이상 |
| 군주   | 자동 소환            | 소환 쿨타임 -30% 선택      |
| 군주   | 미니언 소환 비용 -1  | 소환 슬롯 +1 선택 1회 이상 |
| 군주   | 쌍둥이 소환          | 미니언 소환 비용 -1 선택   |
| 지배자 | 미니언 공격속도 +20% | 공격력 +15% 선택 2회 이상  |
| 지배자 | 크리티컬             | 공격속도 +20% 선택         |
| 지배자 | 미니언 HP +25%       | 공격력 +15% 선택 1회 이상  |
| 지배자 | 뱀파이릭             | 미니언 HP +25% 선택        |
| 사령관 | Explode 데미지 +50%  | Corpse 수용량 +10 선택     |
| 사령관 | Explode 쿨타임 -50%  | Explode 데미지 +50% 선택   |
| 사령관 | 수집 범위 ×2         | Corpse 수용량 +10 선택     |
| 사령관 | 자동 수집            | 수집 범위 ×2 선택          |

> 스킬 경로 노드는 레벨업 선택지와 **별도**로 등장한다. 선행 조건을 만족하면 해당 웨이브의 레벨업 시 선택지 3개 중 하나로 출현할 수 있다.

### 스킬 경로 노드 선택지 풀 통합 규칙

스킬 경로 노드는 기본 카테고리(A/B/C)의 선택지 풀과 **합쳐져서** 등장한다.

```
레벨업 시 선택지 생성 흐름:

1. 카테고리 A 풀 구성:
   - 기본 5종 (상한 미도달 항목만)
   - + 사령관 경로 노드 (선행 조건 충족 시)

2. 카테고리 B 풀 구성:
   - 기본 5종 (상한 미도달 항목만)
   - + 군주 경로 노드 (선행 조건 충족 시)

3. 카테고리 C 풀 구성:
   - 기본 5종
   - + 지배자 경로 노드 (선행 조건 충족 시)

4. 각 카테고리에서 가중치 기반 1개씩 추출 → 총 3개 선택지 제시
```

**스킬 경로 노드 가중치**:

| 노드                 | 카테고리 | 출현 가중치 | 최대 횟수 |
| -------------------- | -------- | ----------- | --------- |
| 소환 쿨타임 -30%     | B        | 6           | 1회       |
| 자동 소환            | B        | 4           | 1회       |
| 미니언 소환 비용 -1  | B        | 5           | 1회       |
| 쌍둥이 소환          | B        | 3           | 1회       |
| 미니언 공격속도 +20% | C        | 7           | 1회       |
| 크리티컬             | C        | 4           | 1회       |
| 미니언 HP +25%       | C        | 7           | 1회       |
| 뱀파이릭             | C        | 3           | 1회       |
| Corpse 수용량 +10    | A        | 6           | 1회       |
| Explode 데미지 +50%  | A        | 4           | 1회       |
| Explode 쿨타임 -50%  | A        | 3           | 1회       |
| 수집 범위 ×2         | A        | 5           | 1회       |
| 자동 수집            | A        | 2           | 1회       |

---

## 메타 진행 (런 간 영구 강화)

### 네크로 코인 (Necro Coin)

- 매 런 종료 시 **생존 시간** 및 **처치 수**에 비례하여 네크로 코인 획득
- 네크로 코인은 영구 강화에 사용

### 획득량 공식

```
네크로 코인 = (생존 시간(초) × 0.5) + (처치 수 × 0.1) + (보스 처치 수 × 10)
```

### 영구 강화 목록

| 강화            | 단계 | 단계별 비용              | 효과                 |
| --------------- | ---- | ------------------------ | -------------------- |
| 시작 HP 증가    | 5    | 10 / 20 / 40 / 80 / 160  | 시작 HP +10 (단계당) |
| 시작 슬롯 증가  | 3    | 30 / 60 / 120            | 시작 소환 슬롯 +1    |
| 시작 Corpse     | 3    | 15 / 30 / 60             | 런 시작 시 Corpse +3 |
| 경험치 보너스   | 5    | 20 / 40 / 80 / 160 / 320 | 경험치 획득량 +10%   |
| Corpse 자석     | 3    | 25 / 50 / 100            | 수집 범위 +0.5       |
| 네크로맨서 방어 | 5    | 15 / 30 / 60 / 120 / 240 | 방어력 +2            |

### 메타 강화 적용 시점 & 방식

- 메타 강화는 **런 시작 시** 초기 스탯에 합산 적용
- 인게임 레벨업 강화와 **독립적으로 누적** (서로 간섭하지 않음)
- 스탯 상한은 메타 강화 + 인게임 강화 **합산** 기준으로 적용

```
예시: HP 상한 계산
- 메타 강화: 시작 HP 증가 5단계 = +50 → 시작 HP 150
- 인게임 강화: 체력 강화 10회 = +200
- 합산: 150 + 200 = 350 → 상한 300 적용 → 최종 HP 300

예시: 소환 슬롯 계산
- 메타 강화: 시작 슬롯 증가 3단계 = +3 → 시작 슬롯 6
- 인게임 강화: 소환 슬롯 확장 9회 = +9
- 합산: 6 + 9 = 15 → 상한 15 도달 (정확히 최대)
```

### 메타 강화 데이터 저장

| 항목        | 방식                                         |
| ----------- | -------------------------------------------- |
| 저장 위치   | `PlayerPrefs` (로컬)                         |
| 저장 키     | `MetaUpgrade_{강화이름}` (int, 현재 단계)    |
| 네크로 코인 | `PlayerPrefs` `NecroCoins` (int)             |
| 저장 시점   | 강화 구매 즉시                               |
| 리셋        | 설정 메뉴에서 전체 리셋 가능 (확인 팝업 2회) |

---

## 언락 시스템

### 미니언 언락

게임 시작 시 T1 스켈레톤 워리어만 소환 가능하다. 나머지 미니언은 특정 조건을 달성하면 영구 언락된다.

| 미니언             | 언락 조건                                   |
| ------------------ | ------------------------------------------- |
| 좀비 (T1)          | 적 50마리 처치 (누적)                       |
| 스켈레톤 아처 (T1) | 웨이브 3 도달                               |
| 그래브 나이트 (T2) | Refine 1회 성공                             |
| 레이스 (T2)        | 웨이브 5 도달                               |
| 본 골렘 (T2)       | 좀비 10마리 소환 (누적)                     |
| 데스 나이트 (T3)   | 그래브 나이트 + 레이스 보유 상태에서 Refine |
| 본 드래곤 (T3)     | 웨이브 10 도달                              |
| 리치 (T3)          | 레이스 5마리 소환 (누적)                    |

### 기능 언락

| 기능                       | 언락 조건              |
| -------------------------- | ---------------------- |
| Refine (합성)              | 웨이브 3 최초 도달     |
| Explode (폭발)             | 웨이브 5 최초 도달     |
| Aggressive Charge 포메이션 | 미니언 5마리 동시 소환 |
| Circular Guard 포메이션    | 보스 1회 처치          |

---

## 난이도 스케일링

### 반복 플레이 난이도 (Ascension)

최종 보스(웨이브 20)를 클리어하면 **Ascension 레벨**이 해금된다.

| Ascension | 효과                                                                     |
| --------- | ------------------------------------------------------------------------ |
| 1         | 적 HP +20%, 적 공격력 +10%                                               |
| 2         | 적 HP +40%, 적 이동속도 +10%, 엘리트 출현 웨이브 3부터                   |
| 3         | 적 HP +70%, 적 공격력 +30%, 보스 패턴 강화                               |
| 4         | 적 HP +100%, 모든 스탯 +50%, 웨이브 간 휴식 5초로 단축 (기본 10초 → 5초) |
| 5         | 적 HP +150%, 적 공격력 +80%, 휴식 없음 (0초), 보스 동시 출현             |

### Ascension 3 보스 패턴 강화 상세

| 보스     | 강화 내용                                                    |
| -------- | ------------------------------------------------------------ |
| 성기사   | 돌진 쿨타임 4초 → 2.5초, 빛기둥 3곳 → 5곳                    |
| 드래곤   | 화염 브레스 폭 1.5 → 2.5 유닛, 화염비 위치 8 → 12곳          |
| 대마법사 | 추적 마법탄 3발 → 5발, 텔레포트 쿨타임 5초 → 3초             |
| 용사     | 성스러운 오라 -30% → -50%, 동료 3명 → 4명 (엘리트 스탯 ×1.5) |

> Ascension 스케일링은 웨이브 스케일링과 **곱연산** (중첩)으로 적용된다. 예: 웨이브 10(HP ×1.8) + Ascension 2(HP +40%) = HP ×1.8 × 1.4 = HP ×2.52

### 설계 의도

- Ascension은 핵심 플레이어를 위한 콘텐츠
- 영구 강화를 최대로 올려도 Ascension 5는 극도로 어렵게 설계
- 각 Ascension 클리어 시 특별 보상 제공

### Ascension 클리어 보상

| Ascension | 보상                                      | 설명                        |
| --------- | ----------------------------------------- | --------------------------- |
| 1         | 칭호: "뼈의 군주"                         | 타이틀 화면에 표시          |
| 2         | 네크로맨서 스킨: 피의 네크로맨서          | 붉은 톤 외형 변경           |
| 3         | 미니언 외형: 황금 스켈레톤                | T1 미니언 금색 외형         |
| 4         | 칭호: "정점의 사령관" + 네크로 코인 ×500  | 특별 칭호 + 대량 코인       |
| 5         | 네크로맨서 스킨: 리치 킹 + 칭호: "불멸자" | 최종 보상, 전용 이펙트 포함 |

- 코스메틱 보상은 게임플레이에 영향 없음 (순수 시각적)
- 칭호는 런 결과 화면과 메인 메뉴에 표시

---

## 런 결과 & 스코어링

### 승리/패배 조건

| 결과           | 조건                                     |
| -------------- | ---------------------------------------- |
| 승리 (Victory) | 웨이브 20 클리어 (최종 보스 처치)        |
| 패배 (Death)   | 네크로맨서 HP가 0에 도달                 |
| 시간 초과      | 없음 (웨이브 20 이후 무한 진행하지 않음) |

- 웨이브 20을 클리어하면 승리 연출 후 결과 화면
- 중도 사망 시 사망 연출 (슬로모션 0.5초) 후 결과 화면

### 런 결과 화면

```
┌─────────────────────────────────────────────┐
│                                             │
│           ☠ RUN RESULT ☠                    │
│                                             │
│   결과:     승리 / 패배                       │
│   등급:     S / A / B / C / D                │
│                                             │
│   ─────── 전투 기록 ───────                  │
│   생존 시간:     14:32                       │
│   최종 웨이브:    20                          │
│   적 처치:       1,247                       │
│   보스 처치:     4                            │
│   최대 미니언:   15                           │
│                                             │
│   ─────── 자원 기록 ───────                  │
│   Corpse 수집:   892                         │
│   Raise 횟수:    67                          │
│   Refine 횟수:   12                          │
│   Explode 횟수:  8                           │
│                                             │
│   ─────── 보상 ───────                      │
│   네크로 코인:   +127                        │
│   맵 시드:       #48291                      │
│                                             │
│   [메타 강화 상점]    [재시작]    [메인 메뉴] │
│                                             │
└─────────────────────────────────────────────┘
```

### 등급 산정

런 퍼포먼스에 따라 등급이 부여된다. 등급은 네크로 코인 보너스에 영향을 준다.

| 등급 | 조건                                                     | 코인 보너스 |
| ---- | -------------------------------------------------------- | ----------- |
| S    | 웨이브 20 클리어 + 사망 0회(무피격 아님, HP 0 도달 없이) | ×2.0        |
| A    | 웨이브 20 클리어                                         | ×1.5        |
| B    | 웨이브 15 이상 도달                                      | ×1.2        |
| C    | 웨이브 10 이상 도달                                      | ×1.0        |
| D    | 웨이브 10 미만                                           | ×0.8        |

> **네크로 코인 최종 계산**: `기본 공식 × 등급 배율 × Ascension 보너스(Ascension 레벨 × 0.2 + 1.0)`
