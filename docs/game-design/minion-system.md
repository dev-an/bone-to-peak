# 미니언(소환수) 시스템

> [← 기획 총괄로 돌아가기](./overview.md)

---

## 개요

미니언은 네크로맨서의 핵심 전투력이다. [시체 경제](./corpse-economy.md)를 통해 소환되며, [포메이션](./formation-system.md)에 따라 배치되어 적을 자동 공격한다.

---

## 미니언 종류 & 티어

### 티어 구조

| 티어 | 명칭          | 소환 비용  | 획득 방법         |
| ---- | ------------- | ---------- | ----------------- |
| T1   | 일반 (Common) | Corpse 1~2 | 기본 Raise        |
| T2   | 정예 (Elite)  | Corpse 3~5 | Raise 또는 Refine |
| T3   | Peak-Guardian | 특수 조건  | Refine 전용       |

### T1 — 일반 미니언

| 미니언          | 역할        | HP  | 공격력 | 공격속도 | 이동속도 | 공격범위       | Corpse 비용 | 슬롯 |
| --------------- | ----------- | --- | ------ | -------- | -------- | -------------- | ----------- | ---- |
| 스켈레톤 워리어 | 근접 딜러   | 30  | 12     | 1.0초    | 4.5      | 1.5 유닛 (근접) | 1           | 1    |
| 스켈레톤 아처   | 원거리 딜러 | 20  | 8      | 1.2초    | 4.0      | 7.0 유닛 (원거리) | 2           | 1    |
| 좀비            | 탱커        | 60  | 6      | 1.5초    | 3.0      | 1.2 유닛 (근접) | 1           | 1    |

### T2 — 정예 미니언

| 미니언        | 역할      | HP  | 공격력 | 공격속도 | 이동속도 | 공격범위              | Corpse 비용 | 슬롯 |
| ------------- | --------- | --- | ------ | -------- | -------- | --------------------- | ----------- | ---- |
| 그래브 나이트 | 돌격 탱커 | 100 | 18     | 1.2초    | 5.0      | 1.8 유닛 (근접)        | 3           | 1    |
| 레이스        | 마법 딜러 | 40  | 25     | 2.0초    | 5.5      | 8.0 유닛 (원거리, 투사체 관통) | 4           | 1    |
| 본 골렘       | 중장 탱커 | 180 | 10     | 2.5초    | 2.0      | 2.0 유닛 (근접, 광역 360°) | 5           | 1    |

### T3 — Peak-Guardian (엘리트 미니언)

Peak-Guardian은 Refine 합성으로만 생성되는 최상위 미니언이다. **소환 슬롯을 2개 차지**한다.

| 미니언      | 역할      | HP  | 공격력 | 공격속도 | 이동속도 | 공격범위              | 합성 재료                  | 슬롯 |
| ----------- | --------- | --- | ------ | -------- | -------- | --------------------- | -------------------------- | ---- |
| 데스 나이트 | 만능형    | 200 | 30     | 1.0초    | 5.0      | 1.8 유닛 (근접) + 6.0 유닛 (검기 투사체) | 그래브 나이트 + 레이스     | 2    |
| 본 드래곤   | 광역 딜러 | 150 | 45     | 3.0초    | 6.0      | 5.0 유닛 (브레스 부채꼴 60°) | 본 골렘 + 스켈레톤 아처 ×3 | 2    |
| 리치        | 서포터    | 80  | 15     | 2.0초    | 4.0      | 8.0 유닛 (원거리)      | 레이스 ×2 + Corpse 10      | 2    |

### 슬롯 비용 요약

| 티어 | 슬롯 비용 | 최대 슬롯(15) 기준 최대 수 |
| --- | --- | --- |
| T1 | 1 | 15마리 |
| T2 | 1 | 15마리 |
| T3 | 2 | 7마리 (1슬롯 잔여) |
| 혼합 예시 | — | T3 ×2 (4슬롯) + T2 ×3 (3슬롯) + T1 ×8 (8슬롯) = 15 |

> Peak-Guardian 합성 조합의 자세한 내용은 [시체 경제 → Refine](./corpse-economy.md#refine--합성)을 참고한다.

---

## AI 행동 패턴

모든 미니언은 상황에 따라 3가지 행동 상태를 전환한다.

### Follow (추종)

- **조건**: 범위 내에 적이 없을 때
- **동작**: 네크로맨서를 따라 이동, 현재 포메이션 위치 유지
- **우선순위**: 포메이션 위치 > 네크로맨서와의 거리

### Attack (공격)

- **조건**: 감지 범위 내에 적이 있을 때
- **감지 범위**: 공격 범위 × 1.5 (원거리 미니언은 사거리의 1.5배 거리에서 감지)
- **동작**: 타겟을 향해 이동 → 공격 범위 진입 시 공격
- **이탈 한계**: 포메이션 위치에서 **5 유닛** 이상 벗어나면 Follow로 복귀
- **타겟 선정 우선순위**:
  1. 네크로맨서에게 가장 가까운 적 (위협 우선)
  2. 같은 거리면 HP가 낮은 적 (빠른 처치)
  3. 엘리트/보스에게는 자동 어그로 없음 (T3 제외)
- **T3 예외**: Peak-Guardian은 엘리트와 보스를 우선 타겟팅

### Guard (경비)

- **조건**: Defensive Phalanx 포메이션이며 적이 접근 중일 때
- **동작**: 포메이션 위치를 고수하며 접근하는 적만 공격
- **특징**: 포메이션 이탈 없이 방어에 집중
- **시각적 구분**: Guard 모드 미니언 발밑에 **파란색 방패 아이콘** 표시

### 상태 전환 다이어그램

```
         적 감지 (감지 범위 진입)
Follow ─────────────────────────→ Attack
  ↑                                  │
  │   적 소멸 or 포메이션 이탈 5u    │
  └──────────────────────────────────┘
  ↑                                  │
  │  Phalanx 전환                    │
  └──────────── Guard ←──────────────┘
                  │
                  │ 다른 포메이션 전환 시
                  └──→ Follow
```

---

## 미니언 패스파인딩

### 이동 방식

미니언은 [Flocking AI](./formation-system.md)를 기반으로 이동하되, 장애물 회피 로직이 추가된다.

| 항목 | 값 |
| --- | --- |
| 기본 이동 | Flocking AI (Separation + Cohesion + Formation Target) |
| 장애물 감지 | 전방 2.0 유닛 레이캐스트 (좌우 30° 포함, 총 3방향) |
| 회피 가중치 | 1.8 (포메이션 Target 2.0보다 약간 낮음) |
| 충돌 처리 | 장애물에 닿으면 슬라이딩 (벽 타기) |

### 장애물 우회 규칙

```
1. 전방에 장애물 감지
   └── 좌/우 레이캐스트 중 빈 방향으로 회피
   └── 양쪽 다 막혀있으면 가까운 모서리 방향으로 이동

2. 포메이션 위치가 장애물 위인 경우
   └── 가장 가까운 유효 위치로 자동 재배치
   └── 장애물 가장자리 + 0.5 유닛 오프셋

3. Attack 모드에서 적이 장애물 반대편인 경우
   └── 원거리 미니언: 시야선(Line of Sight) 확보 가능한 위치로 이동
   └── 근접 미니언: 장애물을 돌아서 접근
```

### 미니언 간 충돌

- 미니언끼리는 **물리적 충돌 없음** (Flocking의 Separation으로 겹침 방지)
- 네크로맨서와 미니언도 충돌 없음 (통과 가능)
- 적과 미니언은 충돌 있음 (서로 밀쳐짐, 밀침 강도 0.5 유닛/초)

---

## 미니언 공격 메카닉 상세

### 근접 공격 (스켈레톤 워리어, 좀비, 그래브 나이트)

| 항목 | 값 |
| --- | --- |
| 히트 판정 | 전방 원형 범위 (공격범위 반경) |
| 히트 대상 | 범위 내 모든 적 (멀티 히트) |
| 애니메이션 | 0.3초 (선딜 0.1초 + 활성 0.15초 + 후딜 0.05초) |
| 넉백 | 없음 (미니언 근접은 넉백 부여하지 않음) |

### 원거리 공격 — 스켈레톤 아처

| 항목 | 값 |
| --- | --- |
| 투사체 속도 | 10 유닛/초 |
| 투사체 크기 | 0.2 × 0.2 유닛 |
| 관통 | 없음 (1회 적중 시 소멸) |
| 사거리 한계 | 7.0 유닛 (도달 후 소멸) |
| 타겟팅 | 발사 시 타겟 위치 예측 (리드샷) |

### 원거리 공격 — 레이스 (투사체 관통)

| 항목 | 값 |
| --- | --- |
| 투사체 속도 | 8 유닛/초 |
| 투사체 크기 | 0.4 × 0.4 유닛 |
| 관통 | **무제한** (투사체가 적을 통과하며 사거리 한계까지 비행) |
| 사거리 한계 | 8.0 유닛 (도달 후 소멸) |
| 관통 피해 감소 | 없음 (관통한 모든 적에게 동일 피해) |
| 시각 표현 | 보라색 마법 구체, 관통 시 잔상 이펙트 |
| 타겟팅 | 발사 시 타겟 방향으로 직선 이동 (유도 없음) |

### 광역 공격 — 본 골렘

| 항목 | 값 |
| --- | --- |
| 범위 | 360도 원형, 반경 2.0 유닛 |
| 히트 대상 | 범위 내 모든 적 |
| 애니메이션 | 0.5초 (선딜 0.2초 + 활성 0.2초 + 후딜 0.1초) |
| 넉백 | 0.8 유닛 (중심에서 바깥 방향) |
| 시각 표현 | 지면 충격파 이펙트 |

### Guard 상태에서의 방어 보너스

- Guard 상태 자체는 **추가 방어 보너스를 부여하지 않음**
- Defensive Phalanx의 "방어력 +30%" 보너스가 Guard 상태 미니언에게도 동일 적용
- Guard의 핵심 가치는 **포메이션 유지** — 미니언이 이탈하지 않아 방패벽 유지

---

## 미니언 생존 & 사망

- 미니언은 적에게 피격당하면 HP가 감소하며, 0이 되면 사망
- 사망한 미니언은 **소환 슬롯을 반환**함
- 사망한 미니언은 시체를 남기지 않음 (무한 루프 방지)
  - **예외**: 리치(T3)는 사망 시 Corpse 3개 드롭
- 미니언에게는 HP 자연 회복이 없음
- 리치(T3)의 특수 능력으로 주변 미니언 HP 회복 가능

### 사망 연출

| 항목 | 값 |
| --- | --- |
| 사망 애니메이션 | 0.5초 (붕괴/소멸 연출) |
| T1 사망 | 뼈가 흩어지는 파티클 (회색) |
| T2 사망 | 마법 에너지 소산 파티클 (청색) |
| T3 사망 | 대형 폭발 파티클 + 화면 미세 흔들림 (0.1초) |
| 슬롯 반환 시점 | 사망 애니메이션 완료 후 즉시 |
| 사망 위치 | 사망 파티클이 잠시 남아 위치 표시 (1초간) |

### HP 표시

- 미니언 머리 위에 소형 HP 바 표시 (HP 100% 미만일 때만)
- HP 바 색상: 녹색(>50%) → 노랑(25~50%) → 빨강(<25%)
- HP 바 크기: 미니언 스프라이트 너비와 동일

---

## Peak-Guardian 상세

Peak-Guardian은 일반 미니언과 다른 특수 능력을 가진다.

### 데스 나이트

- **특수 능력: 죽음의 오라** — 주변 3 유닛 내 적에게 지속 피해 (3/초)
  - 오라 판정: 0.5초 간격으로 `Physics2D.OverlapCircle` (3 유닛 반경, Enemy 레이어)
  - 피해 적용: 오라 범위 내 모든 적에게 1.5 피해/틱 (0.5초 × 3/초)
  - 시각: 데스 나이트 주변 짙은 보라색 원형 이펙트 (항상 표시)
- **패시브**: 처치한 적의 수만큼 공격력 일시 증가 (+2, 최대 +20, 10초 지속)
  - 킬 카운터 리셋: 10초 후 공격력 보너스 초기화
  - 새 킬 발생 시 타이머 갱신 (10초 재시작)
  - 시각: 공격력 버프 활성 시 검에 붉은 이펙트

### 본 드래곤

- **특수 능력: 브레스** — 전방 부채꼴 60도 범위에 45 피해 (쿨타임 5초)
  - 브레스 판정: 60도 부채꼴, 반경 5.0 유닛 (공격범위와 동일)
  - 브레스 방향: 현재 타겟 방향
  - 브레스 지속: 0.5초간 판정 유지 (도중 진입한 적에게도 피해)
  - 시각: 주황색 화염 부채꼴 이펙트
- **패시브**: 비행 유닛으로 지형 장애물 무시
  - 이동 레이어: 장애물 충돌 비활성화
  - 다른 유닛과의 충돌은 정상 적용

### 리치

- **특수 능력: 언데드 치유** — 주변 5 유닛 내 미니언 HP 5/초 회복 (자신 제외)
  - 치유 판정: 1.0초 간격으로 `Physics2D.OverlapCircle` (5 유닛, Minion 레이어)
  - 치유량: 틱당 5 HP (초당 5 HP)
  - 최대 HP 초과 불가
  - 시각: 치유 대상 미니언에 녹색 파티클 상승 이펙트
- **패시브**: 사망 시 Corpse 3개 드롭 (예외적으로 시체를 남김)
  - 드롭 위치: 사망 위치에서 반경 0.3 유닛 내 산란
